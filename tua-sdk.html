<!DOCTYPE html>
<html>
<head>
    <title>Transient User Activation Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
        }
        #status {
            margin: 20px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .active {
            background: #d4edda;
            color: #155724;
        }
        .inactive {
            background: #f8d7da;
            color: #721c24;
        }
        #log {
            border: 1px solid #ccc;
            padding: 10px;
            margin: 20px 0;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
        }
        iframe {
            width: 100%;
            height: 100px;
            border: 1px solid #ccc;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Transient User Activation Test</h1>
    <div id="status">Checking activation status...</div>
    <div>
        <button id="directSwitch">Direct App Switch</button>
        <button id="iframeSwitch">App Switch after Iframe Redirect</button>
    </div>
    <iframe id="testFrame"></iframe>
    <div id="log"></div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `${time}: ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function updateStatus() {
            const status = document.getElementById('status');
            const isActive = navigator.userActivation.isActive;
            status.textContent = `Transient Activation: ${isActive ? 'ACTIVE' : 'INACTIVE'}`;
            status.className = isActive ? 'active' : 'inactive';
        }

        // Update status every 100ms
        setInterval(updateStatus, 100);

        // Direct app switch - should work
        document.getElementById('directSwitch').addEventListener('click', () => {
            log('Direct app switch attempt');
            const isActive = navigator.userActivation.isActive;
            log(`Activation status: ${isActive ? 'ACTIVE' : 'INACTIVE'}`);
            if (isActive) {
                log('Attempting app switch...');
                location.href = 'https://www.paypal.com/app-switch-checkout?token=6X4078591K686073N&tokenType=ORDER_ID&buttonSessionID=uid_109931a52a_mje6mjy6mze&integration_type=web_sdk';
            } else {
                log('Cannot app switch - no activation');
            }
        });

        // App switch after iframe redirect - should fail
        document.getElementById('iframeSwitch').addEventListener('click', () => {
            log('Starting iframe redirect test');
            const isActive = navigator.userActivation.isActive;
            log(`Initial activation status: ${isActive ? 'ACTIVE' : 'INACTIVE'}`);
            
            const frame = document.getElementById('testFrame');
            frame.src = 'about:blank';
            
            // After iframe loads, redirect it
            frame.onload = () => {
                log('Iframe loaded, redirecting...');
                frame.src = 'about:blank?redirect=1';
                
                // After redirect, try app switch
                frame.onload = () => {
                    log('Iframe redirected');
                    const isStillActive = navigator.userActivation.isActive;
                    log(`Activation status after redirect: ${isStillActive ? 'ACTIVE' : 'INACTIVE'}`);
                    
                    if (isStillActive) {
                        log('Attempting app switch...');
                        location.href = 'https://www.paypal.com/app-switch-checkout?token=6X4078591K686073N&tokenType=ORDER_ID&buttonSessionID=uid_109931a52a_mje6mjy6mze&integration_type=web_sdk';
                    } else {
                        log('Cannot app switch - activation consumed by iframe redirect');
                    }
                };
            };
        });
    </script>
</body>
</html>
