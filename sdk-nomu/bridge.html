<!doctype html>
<html lang="en">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Bridge • App Switch</title>
<style>
  :root { color-scheme: light dark; }
  body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; padding:20px }
  .card { max-width:520px; margin:auto; border:1px solid #ddd; border-radius:16px; padding:18px }
  h1 { margin:0 0 8px; font-size:22px } p{ margin:8px 0; line-height:1.4 }
  button { margin-top:12px; width:100%; padding:12px 14px; border:0; border-radius:12px; font-size:16px }
  .primary { background:#0070ba; color:#fff } .hint { opacity:.7; font-size:14px }
</style>

<div class="card">
  <h1>Bridge</h1>
  <p class="hint">This tab stays open while the PayPal app runs.</p>
  <p id="status">Launching PayPal app…</p>
  <button id="relaunch" class="primary" hidden>Open in PayPal app</button>
</div>

<script>
  const q = new URLSearchParams(location.search);
  const token   = q.get("token")   || "EC-EXAMPLE";
  const sdkMeta = q.get("sdkMeta") || "ENCODED_SDK_META";

  // HLD: use a non-www HTTPS app link so OS hands off from a www page:contentReference[oaicite:1]{index=1}
  const appLink = `https://paypal.com/app-switch-checkout?token=${encodeURIComponent(token)}&sdkMeta=${encodeURIComponent(sdkMeta)}`;

  // Prevent Chrome from "snapping back" in history
  history.replaceState(null, "", location.href);
  history.pushState(null, "", location.href);
  addEventListener("popstate", () => history.pushState(null, "", location.href));

  // Launch immediately while transient activation is alive
  try { location.assign(appLink); } catch (e) {}

  // If nothing happened (app not installed), show a manual relaunch button
  setTimeout(() => {
    const btn = document.getElementById("relaunch");
    btn.hidden = false;
    btn.onclick = () => { location.assign(appLink); };
    document.getElementById("status").textContent = "Tap to open PayPal app";
  }, 1200);
</script>
</html>
