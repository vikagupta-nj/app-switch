<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebView Detection Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0 auto;
            padding: 20px;
            max-width: 800px;
            line-height: 1.6;
        }
        header {
            background-color: #007aff;
            color: white;
            padding: 20px 15px;
            text-align: center;
            border-radius: 10px 10px 0 0;
            margin-top: 0;
            margin-bottom: 20px;
        }
        header h1 {
            font-size: 1.6rem;
            margin: 0 0 10px 0;
        }
        header p {
            font-size: 0.9rem;
            margin: 0;
        }
        .detection-results {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .status {
            font-weight: bold;
            color: #333;
        }
        .details {
            margin-top: 10px;
        }
        .detail-item {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <header>
        <h1>WebView Detection</h1>
        <p>Basic detection of WebView environments</p>
    </header>

    <div class="detection-results">
        <h2>Results:</h2>
        <div id="result">Running detection...</div>
        <div class="status">Status: <span id="status">Checking...</span></div>
        <div class="details">
            <h3>Detection Details:</h3>
            <div id="details"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const resultEl = document.getElementById('result');
            const statusEl = document.getElementById('status');
            const detailsEl = document.getElementById('details');

            // Collection of detection techniques
            const detectionResults = [];

            // 1. User Agent detection
            const userAgent = navigator.userAgent;
            const isAndroidUA = /Android/i.test(userAgent);
            const isIOSUA = /iPhone|iPad|iPod/i.test(userAgent);
            const hasWebViewIndication = /(WebView|wv)|(Version\/\d+\.\d+)/i.test(userAgent);

            addDetail('User Agent', userAgent);
            addDetail('Detected Android in UA', isAndroidUA);
            addDetail('Detected iOS in UA', isIOSUA);
            addDetail('WebView indication in UA', hasWebViewIndication);

            // 2. WebView specific objects/properties
            const hasAndroidWebViewObj = typeof window.AndroidInterface !== 'undefined' ||
                                         typeof window.Android !== 'undefined';
            const hasIOSWebViewObj = typeof window.webkit !== 'undefined' &&
                                    typeof window.webkit.messageHandlers !== 'undefined';

            addDetail('Android WebView objects', hasAndroidWebViewObj);
            addDetail('iOS WKWebView objects', hasIOSWebViewObj);

            // 3. Custom URL scheme support
            function checkURLScheme(scheme) {
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                document.body.appendChild(iframe);

                try {
                    iframe.contentWindow.location.href = scheme + '://';
                    return true; // If it doesn't throw, scheme might be supported
                } catch (e) {
                    return false;
                } finally {
                    document.body.removeChild(iframe);
                }
            }

            // Skip actual checking to avoid security issues, but demonstrate the approach
            addDetail('Custom URL scheme check', 'Demo only (not executed)');

            // 4. Storage limitations
            try {
                localStorage.setItem('webviewTest', 'test');
                localStorage.removeItem('webviewTest');
                addDetail('localStorage available', true);
            } catch (e) {
                addDetail('localStorage available', false);
                detectionResults.push('Limited storage access (common in some WebViews)');
            }

            // 5. Check for missing browser features
            const hasCookies = navigator.cookieEnabled;
            const hasServiceWorker = 'serviceWorker' in navigator;

            addDetail('Cookies enabled', hasCookies);
            addDetail('Service Worker API', hasServiceWorker);

            // 6. Performance characteristics
            const hasDeviceMemory = 'deviceMemory' in navigator;
            const hasBatteryAPI = 'getBattery' in navigator;

            addDetail('Device Memory API', hasDeviceMemory);
            addDetail('Battery API', hasBatteryAPI);

            // 7. Known WebView identifiers
            const isXWalk = /Crosswalk/i.test(userAgent);
            const isUCBrowser = /UCBrowser/i.test(userAgent);
            const isFacebookBrowser = /FB(AN|AV|_IAB)/i.test(userAgent);

            addDetail('Crosswalk WebView', isXWalk);
            addDetail('UC Browser WebView', isUCBrowser);
            addDetail('Facebook in-app browser', isFacebookBrowser);

            // 8. Meta viewport behavior (not reliably detectable in script)
            addDetail('Meta viewport behavior', 'Cannot detect programmatically');

            // 9. Inject platform-specific app detection
            function detectAppByUA() {
                const apps = [
                    { name: 'Facebook', pattern: /FBAV|FBAN/ },
                    { name: 'Instagram', pattern: /Instagram/ },
                    { name: 'Twitter', pattern: /Twitter/ },
                    { name: 'LinkedIn', pattern: /LinkedIn/ },
                    { name: 'WhatsApp', pattern: /WhatsApp/ },
                    { name: 'Snapchat', pattern: /Snapchat/ },
                    { name: 'Pinterest', pattern: /Pinterest/ },
                    { name: 'WeChat', pattern: /MicroMessenger/ }
                ];

                const detectedApps = apps.filter(app => app.pattern.test(userAgent));
                if (detectedApps.length > 0) {
                    return detectedApps.map(app => app.name).join(', ');
                }
                return 'None detected';
            }

            // Function to detect the browser name
            function detectBrowserName() {
                const ua = navigator.userAgent;
                let browserName;

                if (ua.indexOf("Edge") > -1) {
                    browserName = "Microsoft Edge (Legacy)";
                } else if (ua.indexOf("Edg") > -1) {
                    browserName = "Microsoft Edge (Chromium)";
                } else if (ua.indexOf("OPR") > -1 || ua.indexOf("Opera") > -1) {
                    browserName = "Opera";
                } else if (ua.indexOf("Chrome") > -1) {
                    browserName = "Chrome";
                } else if (ua.indexOf("Safari") > -1) {
                    browserName = "Safari";
                } else if (ua.indexOf("Firefox") > -1) {
                    browserName = "Firefox";
                } else if (ua.indexOf("MSIE") > -1 || ua.indexOf("Trident") > -1) {
                    browserName = "Internet Explorer";
                } else if (ua.indexOf("UCBrowser") > -1) {
                    browserName = "UC Browser";
                } else if (ua.indexOf("Samsung") > -1) {
                    browserName = "Samsung Browser";
                } else {
                    browserName = "Unknown Browser";
                }

                return browserName;
            }

            addDetail('Specific app WebView', detectAppByUA());

            // 10. Detect WKWebView or UIWebView (iOS)
            const isWKWebView = /AppleWebKit\/[0-9.]+.*Safari\/[0-9.]+$/.test(userAgent) &&
                               isIOSUA &&
                               typeof window.webkit !== 'undefined';
            const isUIWebView = isIOSUA && !isWKWebView && !/Safari/i.test(userAgent);

            addDetail('iOS WKWebView', isWKWebView);
            addDetail('iOS UIWebView (deprecated)', isUIWebView);

            // Make a determination
            const isInWebView = hasAndroidWebViewObj ||
                               hasIOSWebViewObj ||
                               isUIWebView ||
                               (isWKWebView && !(/Safari/i.test(userAgent))) ||
                               isFacebookBrowser ||
                               (hasWebViewIndication && (isAndroidUA || isIOSUA));

            // Update UI with final determination
            if (isInWebView) {
                // Check if it's a browser's WebView like Facebook or Instagram
                const detectedApp = detectAppByUA();
                if (detectedApp !== 'None detected') {
                    resultEl.textContent = 'You are browsing from: ' + detectedApp;
                    statusEl.textContent = 'App Browser Detected';
                    statusEl.style.color = '#2d8a2d';
                } else {
                    resultEl.textContent = 'You are browsing from a WebView';
                    statusEl.textContent = 'WebView Detected';
                    statusEl.style.color = '#2d8a2d';
                }
            } else {
                // Identify the browser
                const browserName = detectBrowserName();
                resultEl.textContent = 'You are browsing from: ' + browserName;
                statusEl.textContent = 'Regular Browser';
                statusEl.style.color = '#0066cc';
            }

            // Helper function to add details
            function addDetail(name, value) {
                const detailItem = document.createElement('div');
                detailItem.className = 'detail-item';
                detailItem.innerHTML = `<strong>${name}:</strong> ${value}`;
                detailsEl.appendChild(detailItem);

                // Add positive results to detection results array
                if (value === true && name !== 'Cookies enabled') {
                    detectionResults.push(name);
                }
            }

            // Add custom UA header information
            const hiddenSpan = document.createElement('span');
            hiddenSpan.style.display = 'none';
            hiddenSpan.id = 'ua-data';
            hiddenSpan.dataset.userAgent = userAgent;
            hiddenSpan.dataset.isWebView = isInWebView;
            document.body.appendChild(hiddenSpan);
        });
    </script>
</body>
</html>